{
  "hash": "6b5941b0b7230d1465e86e63cf34e6e9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Introduction to Multilevel Regression\"\nsubtitle: \"Moving Beyond Single-Level Models & Dealing With Clustering in Data\"\nauthor: \"Paul Johnson\"\n---\n\n\n\n\n# What is Multilevel Data? {data-background-color=\"#425563\" data-verticator=\"#E8EDEE\"}\n\nUnderstanding Grouping Structures in Data\n\n## Multilevel Data is Everywhere {.center}\n\n- Typical regression methods assume a flat single-level data structure, which does not account for the complexity that we often find in real-world data.\n  - This means that single-level regression methods assume that all observations are independent of each other.\n- It is very common to find that there are \"grouping structures\" in your data. This is multilevel data!\n- Multilevel data is so common that our starting assumption should be that any data has grouping structures that need to be accounted for [@mcelreath2017].\n- Whenever you have multiple measurements per group, across many grouping units, you have multilevel data [@thieu2020]!\n\n## Many Sources of Clustering {.center}\n\n- Multilevel data can take lots of different forms, some more obvious than others.\n- The most intuitive (and probably most common) type of grouping structure is hierarchical.  \n  - Observations are clustered based on some higher-level grouping. Some common examples include countries, cities, and school classes.\n- Not all grouping structures are hierarchical. Data can also cluster at the observation-level.\n  - Characteristics like gender, ethnicity, or social class, can lead to clustering.\n  - Another very common form of observation-level grouping is \"repeated measurements\".\n- Observations within groups that are more similar to each other than to observations in other groups indicate a multilevel problem.\n\n## Population-Level Grouping Structures {.center}\n\n\n::: {.cell}\n\n```{.r .cell-code}\navocados |> \n  ggplot(aes(log(total_volume), fill = type)) +\n  geom_histogram(position = \"identity\", alpha = 0.5) +\n  labs(x = \"Total Volume\", y = NULL) +\n  scwplot::scale_fill_qualitative(palette = \"scw\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/avocado-sales-1.png){width=1800}\n:::\n:::\n\n\n## Hierarchical Grouping Structures {.center}\n\n\n::: {.cell}\n\n```{.r .cell-code}\navocados |> \n  filter(region %in% c(\"Houston\", \"Seattle\", \"Syracuse\")) |> \n  ggplot(aes(log(total_volume), fill = type)) +\n  geom_histogram(position = \"identity\", alpha = 0.5) +\n  facet_wrap(~ region, nrow = 3) +\n  labs(x = \"Total Volume\", y = NULL) +\n  scwplot::scale_fill_qualitative(palette = \"scw\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/avocado-sales-by-region-1.png){width=1800}\n:::\n:::\n\n\n## Hierarchical Grouping Structures {.center}\n\n\n::: {.cell}\n\n```{.r .cell-code}\navocados |> \n  filter(region %in% c(\"Houston\", \"Seattle\", \"Syracuse\")) |> \n  ggplot(aes(average_price, log(total_volume), colour = region)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = lm, se = FALSE) +\n  facet_wrap(~ type) +\n  labs(x = \"Average Price\", y = \"Total Volume\") +\n  scwplot::scale_colour_qualitative(palette = \"scw\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/avocado-types-1.png){width=1800}\n:::\n:::\n\n\n# Multilevel Problems {data-background-color=\"#425563\" data-verticator=\"#E8EDEE\"}\n\nIssues with Using Single-Level Models for Multilevel Problems\n\n## Why Does it Matter? {.center}\n\n- When you have multilevel data, it is necessary to think about variance _within groups_ and _between groups_.\n  - Observations _within groups_ are often more alike than observations _between groups_.\n- Single-level regression models do not account for the complexity of multilevel data, either ignoring it entirely (complete pooling) or treating groups as independent (no pooling).\n- Failure to account for grouping structures in data can violate assumptions and bias estimates.\n\n## Assumption of Independence {.center}\n\n- The independence assumption is one of the four assumptions of linear regression.\n- It assumes that your residuals are all independent - observations (and their residuals) should not be correlated.\n- When there is clustering among observations, this violates the independence assumption.\n- This is the worst assumption to violate! \n  - Artificially inflates probability estimates.\n  - Creates the appearance of certainty where it does not exist.\n\n## Simpson's Paradox {.center}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatasauRus::simpsons_paradox |> \n  ggplot(aes(x = x, y = y, colour = dataset)) +\n  geom_point() +\n  geom_smooth(method = lm, se = FALSE) +\n  facet_wrap(~ dataset, nrow = 2) +\n  scwplot::scale_colour_qualitative(palette = \"scw\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/simpsons-paradox-1.png){width=1800}\n:::\n:::\n\n\n# Multilevel Regression {data-background-color=\"#425563\" data-verticator=\"#E8EDEE\"}\n\nMultilevel Solutions for Multilevel Problems!\n\n## What is Multilevel Regression? {.center}\n\n- Single-level models treat clusters as unrelated to others, forgetting everything they've learned from each cluster. If the clusters are of the same type, this is leaving valuable information on the table [@mcelreath2017].\n  - Multilevel models (MLMs) remember features of each cluster in the data as they learn about all of the clusters [@mcelreath2018].\n  - Pooling information across groups/clusters helps improve estimates about each group/cluster.\n- MLMs allow us to fit regression models to individual level while accounting for systematic unexplained variation among groups [@gelman2006].\n- MLMs are appropriate when you care about group differences, when you have many groups, and when there are imbalances among groups.\n\n## Multilevel Regression Types {.center}\n\n- MLMs are very flexible, and can be fit to many different types of multilevel data.\n- They can be fit to data with many different levels, various kinds of grouping structures, and all kinds of relationships between variables.\n- There are three main types of MLMs - varying intercepts, varying slopes, and varying intercepts and slopes.\n\n![](man/figures/multilevel_data.webp){fig-align=\"center\" width=60%} \n\n## Estimating Group Effects {.center}\n\n- We can build a \"null model\" to examine how much of the variance in the data can be explained by the grouping structure.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmer(total_volume ~ 1 + (1 | region), data = avocados) |> \n  performance::icc() |> \n  janitor::clean_names(replace = c(\"ICC\" = \"\"), \"title\") |>\n  tidyr::pivot_longer(everything(), names_to = \"ICC\", values_to = \"Value\") |>\n  gt() |>\n  tab_header(\"Intraclass Correlation Coefficient (ICC)\") |>\n  fmt_number(columns = is.numeric, decimals = 2) |>\n  tab_options(table.width = pct(100))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"upybtwxihv\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#upybtwxihv table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#upybtwxihv thead, #upybtwxihv tbody, #upybtwxihv tfoot, #upybtwxihv tr, #upybtwxihv td, #upybtwxihv th {\n  border-style: none;\n}\n\n#upybtwxihv p {\n  margin: 0;\n  padding: 0;\n}\n\n#upybtwxihv .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 100%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#upybtwxihv .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#upybtwxihv .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#upybtwxihv .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#upybtwxihv .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#upybtwxihv .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#upybtwxihv .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#upybtwxihv .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#upybtwxihv .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#upybtwxihv .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#upybtwxihv .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#upybtwxihv .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#upybtwxihv .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#upybtwxihv .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#upybtwxihv .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upybtwxihv .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#upybtwxihv .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#upybtwxihv .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#upybtwxihv .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upybtwxihv .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#upybtwxihv .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upybtwxihv .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#upybtwxihv .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upybtwxihv .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#upybtwxihv .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upybtwxihv .gt_left {\n  text-align: left;\n}\n\n#upybtwxihv .gt_center {\n  text-align: center;\n}\n\n#upybtwxihv .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#upybtwxihv .gt_font_normal {\n  font-weight: normal;\n}\n\n#upybtwxihv .gt_font_bold {\n  font-weight: bold;\n}\n\n#upybtwxihv .gt_font_italic {\n  font-style: italic;\n}\n\n#upybtwxihv .gt_super {\n  font-size: 65%;\n}\n\n#upybtwxihv .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#upybtwxihv .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#upybtwxihv .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#upybtwxihv .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#upybtwxihv .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#upybtwxihv .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#upybtwxihv .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#upybtwxihv .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#upybtwxihv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"2\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Intraclass Correlation Coefficient (ICC)</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ICC\">ICC</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Value\">Value</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"ICC\" class=\"gt_row gt_left\">Adjusted</td>\n<td headers=\"Value\" class=\"gt_row gt_right\">0.38</td></tr>\n    <tr><td headers=\"ICC\" class=\"gt_row gt_left\">Conditional</td>\n<td headers=\"Value\" class=\"gt_row gt_right\">0.38</td></tr>\n    <tr><td headers=\"ICC\" class=\"gt_row gt_left\">Unadjusted</td>\n<td headers=\"Value\" class=\"gt_row gt_right\">0.38</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n## Varying Intercepts {.center}\n\n- Varying intercepts are the most common type of multilevel model (and the easiest to understand).\n- Instead of fitting a model that pools all information about groups and fits a single line to the data, it fits a line to each group.\n- We are estimating the model but letting each group have a different value at 0.\n\n## Varying Intercepts {.center}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvarying_intercepts <-       \n  lmer(\n    log(total_volume) ~ average_price + organic + (1 | region), \n    data = avocados\n    )\n\nmodelsummary::msummary(\n  list(\"Total Volume\" = varying_intercepts),\n  statistic = 'conf.int', coef_map = cm, gof_omit = \"AIC|BIC|R2\", \n  fmt = 2, exponentiate = TRUE, output = \"gt\",\n  title = \"Multilevel Regression of Avocado Sales\"\n  ) |>\n  tab_row_group(md(\"**Group Effects**\"), rows = 7:8) |>\n  tab_row_group(md(\"**Population Effects**\"), rows = 1:6) |>\n  tab_style(\n    style = cell_text(size = \"x-small\"), \n    locations = cells_body(columns = 2, rows = c(2, 4, 6))\n  ) |> \n  tab_options(table.width = pct(100), table.font.size = 12)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"aidbvadouq\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#aidbvadouq table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#aidbvadouq thead, #aidbvadouq tbody, #aidbvadouq tfoot, #aidbvadouq tr, #aidbvadouq td, #aidbvadouq th {\n  border-style: none;\n}\n\n#aidbvadouq p {\n  margin: 0;\n  padding: 0;\n}\n\n#aidbvadouq .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 12px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 100%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#aidbvadouq .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#aidbvadouq .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#aidbvadouq .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#aidbvadouq .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#aidbvadouq .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#aidbvadouq .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#aidbvadouq .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#aidbvadouq .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#aidbvadouq .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#aidbvadouq .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#aidbvadouq .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#aidbvadouq .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#aidbvadouq .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#aidbvadouq .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aidbvadouq .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#aidbvadouq .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#aidbvadouq .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#aidbvadouq .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aidbvadouq .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#aidbvadouq .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aidbvadouq .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#aidbvadouq .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aidbvadouq .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#aidbvadouq .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aidbvadouq .gt_left {\n  text-align: left;\n}\n\n#aidbvadouq .gt_center {\n  text-align: center;\n}\n\n#aidbvadouq .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#aidbvadouq .gt_font_normal {\n  font-weight: normal;\n}\n\n#aidbvadouq .gt_font_bold {\n  font-weight: bold;\n}\n\n#aidbvadouq .gt_font_italic {\n  font-style: italic;\n}\n\n#aidbvadouq .gt_super {\n  font-size: 65%;\n}\n\n#aidbvadouq .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#aidbvadouq .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#aidbvadouq .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#aidbvadouq .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#aidbvadouq .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#aidbvadouq .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#aidbvadouq .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#aidbvadouq .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#aidbvadouq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <caption>Multilevel Regression of Avocado Sales</caption>\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\" \"> </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Total Volume\">Total Volume</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"&lt;div data-qmd-base64=&quot;KipQb3B1bGF0aW9uIEVmZmVjdHMqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Population Effects&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipQb3B1bGF0aW9uIEVmZmVjdHMqKg==\"><div class='gt_from_md'><p><strong>Population Effects</strong></p>\n</div></div></th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"**Population Effects**   \" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"**Population Effects**  Total Volume\" class=\"gt_row gt_center\">732844.18</td></tr>\n    <tr><td headers=\"**Population Effects**   \" class=\"gt_row gt_left\"></td>\n<td headers=\"**Population Effects**  Total Volume\" class=\"gt_row gt_center\" style=\"font-size: x-small;\">[564203.10, 951892.30]</td></tr>\n    <tr><td headers=\"**Population Effects**   \" class=\"gt_row gt_left\">Average Price</td>\n<td headers=\"**Population Effects**  Total Volume\" class=\"gt_row gt_center\">0.52</td></tr>\n    <tr><td headers=\"**Population Effects**   \" class=\"gt_row gt_left\"></td>\n<td headers=\"**Population Effects**  Total Volume\" class=\"gt_row gt_center\" style=\"font-size: x-small;\">[0.51, 0.53]</td></tr>\n    <tr><td headers=\"**Population Effects**   \" class=\"gt_row gt_left\">Organic</td>\n<td headers=\"**Population Effects**  Total Volume\" class=\"gt_row gt_center\">0.04</td></tr>\n    <tr><td headers=\"**Population Effects**   \" class=\"gt_row gt_left\"></td>\n<td headers=\"**Population Effects**  Total Volume\" class=\"gt_row gt_center\" style=\"font-size: x-small;\">[0.04, 0.04]</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"&lt;div data-qmd-base64=&quot;KipHcm91cCBFZmZlY3RzKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Group Effects&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipHcm91cCBFZmZlY3RzKio=\"><div class='gt_from_md'><p><strong>Group Effects</strong></p>\n</div></div></th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"**Group Effects**   \" class=\"gt_row gt_left\">Region Intercept Variance</td>\n<td headers=\"**Group Effects**  Total Volume\" class=\"gt_row gt_center\">2.46</td></tr>\n    <tr><td headers=\"**Group Effects**   \" class=\"gt_row gt_left\" style=\"border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;\">Residual Variance</td>\n<td headers=\"**Group Effects**  Total Volume\" class=\"gt_row gt_center\" style=\"border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;\">1.57</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_empty_group_heading\" scope=\"colgroup\" id=\"\"></th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"NA   \" class=\"gt_row gt_left\">Num.Obs.</td>\n<td headers=\"NA  Total Volume\" class=\"gt_row gt_center\">15545</td></tr>\n    <tr><td headers=\"NA   \" class=\"gt_row gt_left\">ICC</td>\n<td headers=\"NA  Total Volume\" class=\"gt_row gt_center\">0.8</td></tr>\n    <tr><td headers=\"NA   \" class=\"gt_row gt_left\">RMSE</td>\n<td headers=\"NA  Total Volume\" class=\"gt_row gt_center\">0.45</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n## Varying Intercepts {.center}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvarying_intercepts |> \n  ggeffects::predict_response(c(\"average_price\", \"organic\")) |> \n  tibble() |> \n  mutate(type = if_else(group == 0, \"Conventional\", \"Organic\")) |> \n  ggplot(aes(x, predicted, group = type, colour = type)) +\n  geom_point(size = 1.5) +\n  geom_line(linewidth = 1) +\n  geom_line(aes(y = conf.low), linetype = 2) +\n  geom_line(aes(y = conf.high), linetype = 2) +\n  scale_x_continuous(labels = label_currency()) +\n  scale_y_continuous(\n    labels = label_number(scale_cut = cut_short_scale())\n    ) +\n  labs(x = \"Average Price\", y = \"Total Volume\") +\n  scwplot::scale_colour_qualitative(\"scw\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/population-effects-1.png){width=1800}\n:::\n:::\n\n\n## Varying Intercepts {.center}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvarying_intercepts |> \n  ggeffects::predict_response(\n    c(\"average_price\", \"organic\", \"region\"), type = \"random\"\n    ) |>\n  tibble() |> \n  filter(facet %in% c(\"Houston\", \"Seattle\", \"Syracuse\")) |> \n  mutate(type = if_else(group == 0, \"Conventional\", \"Organic\")) |>\n  ggplot(aes(x, predicted, group = type, colour = type)) +\n  geom_point(size = 1.5) +\n  geom_line(linewidth = 1) +\n  geom_line(aes(y = conf.low), linetype = 2) +\n  geom_line(aes(y = conf.high), linetype = 2) +\n  facet_wrap(facets = vars(facet), nrow = 3) +\n  scale_x_continuous(labels = label_currency()) +\n  scale_y_continuous(\n    labels = label_number(scale_cut = cut_short_scale())\n    ) +\n  labs(x = \"Average Price\", y = \"Total Volume\") +\n  scwplot::scale_colour_qualitative(\"scw\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/group-effects-1.png){width=1800}\n:::\n:::\n\n\n## Conclusion {.center}\n\n- Multilevel data is very common, and we should start by assuming our data has grouping structures in it.\n- Not accounting for those grouping structures can cause a lot of problems.\n- Multilevel regression is flexible, powerful, and incredibly effective!\n\n# Thank You!\n\nContact:\n<br>\n\n<ul >\n{{< fa solid envelope >}} [paul.johnson50@nhs.net](mailto: paul.johnson50@nhs.net)\n</ul>\n\n\nCode & Slides:\n<br>\n\n<ul >\n{{< fa brands github >}}[/NHS-South-Central-and-West/handling-missing-values](https://github.com/nhs-south-central-and-west/handling-missing-values)\n</ul>\n\n## References\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}